<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Payroll Calendar</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            min-height: 600px;
        }

        .calendar-section {
            flex: 2;
            min-width: 800px;
            padding: 30px;
            background: #f8f9fa;
        }

        .results-section {
            flex: 1;
            min-width: 400px;
            padding: 30px;
            background: white;
        }

        .section-title {
            font-size: 1.5em;
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .employee-selector {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .employee-item {
            background: #f8f9fa;
            padding: 10px 15px;
            margin-bottom: 8px;
            border-radius: 5px;
            border-left: 4px solid #3498db;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .employee-item:hover {
            background: #ecf0f1;
            transform: translateX(5px);
        }

        .employee-item.selected {
            border-left-color: #27ae60;
            background: #e8f5e8;
        }

        .employee-management {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
            display: none;
        }

        .employee-management.show {
            display: block;
        }

        .toggle-btn {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .template-buttons {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #e0e0e0;
        }

        .template-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-template {
            background: linear-gradient(135deg, #16a085 0%, #27ae60 100%);
            color: white;
            padding: 12px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            text-align: center;
            font-size: 14px;
            line-height: 1.2;
            transition: transform 0.2s ease;
        }

        .btn-template:hover {
            transform: translateY(-2px);
            background: linear-gradient(135deg, #138d75 0%, #229954 100%);
        }

        .btn-template.day-shift {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        }

        .btn-template.evening-shift {
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
        }

        .btn-template.night-shift {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        .calendar-container {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            border: 2px solid #e0e0e0;
        }

        .calendar-header {
            background: #34495e;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }

        .calendar-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #2c3e50;
            padding: 10px 20px;
            color: white;
        }

        .nav-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
        }

        .nav-btn:hover {
            background: #2980b9;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .day-header {
            background: #ecf0f1;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #2c3e50;
            border-bottom: 1px solid #bdc3c7;
        }

        .calendar-cell {
            min-height: 120px;
            border: 1px solid #e0e0e0;
            padding: 8px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .calendar-cell:hover {
            background: #f8f9fa;
        }

        .calendar-cell.selected {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .calendar-cell.weekend {
            background: #faf6ff;
        }

        .calendar-cell.holiday {
            background: #fff3e0;
        }

        .cell-date {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .cell-shifts {
            font-size: 11px;
        }

        .shift-item {
            background: #3498db;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            margin-bottom: 2px;
            font-size: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shift-item.day-shift {
            background: #f39c12;
        }

        .shift-item.evening-shift {
            background: #8e44ad;
        }

        .shift-item.night-shift {
            background: #2c3e50;
        }

        .shift-item.holiday {
            background: #e74c3c;
        }

        .shift-remove {
            cursor: pointer;
            margin-left: 5px;
            font-weight: bold;
        }

        .shift-remove:hover {
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: 0;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #34495e;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
        }

        .btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            width: auto;
            padding: 8px 15px;
            font-size: 14px;
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background: #f39c12;
            color: white;
            font-weight: 600;
        }

        .alert.success {
            background: #27ae60;
        }

        .alert.error {
            background: #e74c3c;
        }

        .alert.info {
            background: #3498db;
        }

        .pay-stub {
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 25px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }

        .pay-stub-header {
            text-align: center;
            border-bottom: 2px solid #34495e;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .pay-stub-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }

        .pay-stub-section {
            margin-bottom: 15px;
        }

        .pay-stub-section h4 {
            color: #34495e;
            margin-bottom: 8px;
            font-size: 1em;
            border-bottom: 1px solid #bdc3c7;
            padding-bottom: 3px;
        }

        .pay-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
            padding: 1px 0;
        }

        .pay-row.gross-pay {
            font-size: 1.1em;
            background: #e8f5e8;
            padding: 8px;
            border-radius: 5px;
            border: 2px solid #27ae60;
            font-weight: bold;
            margin-top: 10px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }

        .stat-label {
            font-size: 0.9em;
            color: #7f8c8d;
            margin-top: 5px;
        }

        @media (max-width: 1200px) {
            .main-content {
                flex-direction: column;
            }
            
            .calendar-section, .results-section {
                min-width: auto;
            }

            .calendar-grid {
                font-size: 12px;
            }

            .calendar-cell {
                min-height: 80px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📅 Smart Payroll Calendar</h1>
            <p>Click calendar cells to add shifts - automatic calculation of premiums and overtime</p>
        </div>

        <div class="main-content">
            <div class="calendar-section">
                <h2 class="section-title">Schedule & Shifts</h2>
                
                <!-- Employee Selector -->
                <div class="employee-selector">
                    <h4>Select Employee:</h4>
                    <div id="employeeList">
                        <div class="alert">Loading employees...</div>
                    </div>
                    <button class="toggle-btn" onclick="toggleEmployeeManagement()">+ Manage Employees</button>
                </div>

                <!-- Employee Management (Hidden by default) -->
                <div class="employee-management" id="employeeManagement">
                    <h4>Add New Employee</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="employeeName">Name</label>
                            <input type="text" id="employeeName" placeholder="Enter employee name">
                        </div>
                        <div class="form-group">
                            <label for="hourlyRate">Hourly Rate ($)</label>
                            <input type="number" id="hourlyRate" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="department">Department</label>
                            <input type="text" id="department" placeholder="Enter department">
                        </div>
                        <div class="form-group">
                            <button class="btn btn-secondary" onclick="addEmployee()">Add Employee</button>
                        </div>
                    </div>
                </div>

                <!-- Quick Shift Templates -->
                <div class="template-buttons">
                    <h4 style="margin-bottom: 10px;">Quick Add Shifts:</h4>
                    <div class="template-row">
                        <button class="btn-template day-shift" onclick="setSelectedShiftType('day')">
                            ☀️ Day Shift<br><small>07:00 - 15:00</small>
                        </button>
                        <button class="btn-template evening-shift" onclick="setSelectedShiftType('evening')">
                            🌅 Evening<br><small>15:00 - 23:00</small>
                        </button>
                        <button class="btn-template night-shift" onclick="setSelectedShiftType('night')">
                            🌙 Night<br><small>23:00 - 07:00</small>
                        </button>
                    </div>
                    <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #7f8c8d;">
                        Select shift type above, then click calendar cells to add shifts
                    </div>
                </div>

                <!-- Calendar -->
                <div class="calendar-container">
                    <div class="calendar-nav">
                        <button class="nav-btn" onclick="changeWeek(-1)">← Previous</button>
                        <span id="calendarTitle">2 Week Schedule</span>
                        <button class="nav-btn" onclick="changeWeek(1)">Next →</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="day-header">Sunday</div>
                        <div class="day-header">Monday</div>
                        <div class="day-header">Tuesday</div>
                        <div class="day-header">Wednesday</div>
                        <div class="day-header">Thursday</div>
                        <div class="day-header">Friday</div>
                        <div class="day-header">Saturday</div>
                    </div>
                    <div class="calendar-grid" id="calendarGrid">
                        <!-- Calendar cells will be generated here -->
                    </div>
                </div>

                <button class="btn" onclick="calculatePayroll()" style="margin-top: 20px;">Calculate Payroll for Period</button>
            </div>

            <div class="results-section">
                <h2 class="section-title">Payroll Results</h2>
                
                <!-- Summary Stats -->
                <div id="summaryStats" class="summary-stats" style="display: none;">
                    <div class="stat-card">
                        <div class="stat-value" id="totalHoursStat">0</div>
                        <div class="stat-label">Total Hours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="overtimeHoursStat">0</div>
                        <div class="stat-label">Overtime Hours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="weekendHoursStat">0</div>
                        <div class="stat-label">Weekend Hours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="nightHoursStat">0</div>
                        <div class="stat-label">Night Hours</div>
                    </div>
                </div>

                <div id="results">
                    <div class="alert">
                        Select an employee and add shifts to the calendar to calculate payroll.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SmartPayrollCalculator {
            constructor() {
                this.employees = [];
                this.shifts = [];
                this.payPeriods = [];
                this.nextId = 1;
                this.nextShiftId = 1;
                this.currentWeekStart = this.getWeekStart(new Date());
                this.selectedShiftType = 'day';
                
                // BC Statutory Holidays 2025
                this.holidays = [
                    '2025-01-01', '2025-02-17', '2025-03-29', '2025-05-19',
                    '2025-07-01', '2025-08-04', '2025-09-01', '2025-10-13',
                    '2025-11-11', '2025-12-25', '2025-12-26'
                ];

                this.premiumHolidays = ['2025-01-01', '2025-12-25'];
            }

            addEmployee(name, hourlyRate, department = 'General') {
                const employee = {
                    id: this.nextId++,
                    name,
                    hourlyRate,
                    department,
                    dateHired: new Date()
                };
                this.employees.push(employee);
                return employee;
            }

            getEmployee(id) {
                return this.employees.find(emp => emp.id === id);
            }

            addShift(employeeId, date, shiftType = 'day') {
                const shiftTimes = {
                    day: { start: '07:00', end: '15:00' },
                    evening: { start: '15:00', end: '23:00' },
                    night: { start: '23:00', end: '07:00' }
                };

                const times = shiftTimes[shiftType];
                const startDateTime = new Date(`${date}T${times.start}`);
                const endDateTime = new Date(`${date}T${times.end}`);
                
                // Handle overnight shifts
                if (endDateTime < startDateTime) {
                    endDateTime.setDate(endDateTime.getDate() + 1);
                }

                const duration = (endDateTime - startDateTime) / (1000 * 60 * 60);

                const shift = {
                    id: this.nextShiftId++,
                    employeeId,
                    date,
                    shiftType,
                    startTime: times.start,
                    endTime: times.end,
                    startDateTime,
                    endDateTime,
                    duration,
                    premiums: this.calculateShiftPremiums(startDateTime, endDateTime, date)
                };

                this.shifts.push(shift);
                return shift;
            }

            calculateShiftPremiums(startDateTime, endDateTime, date) {
                const premiums = {
                    isWeekend: false,
                    isHoliday: false,
                    isPremiumHoliday: false,
                    nightHours: 0,
                    eveningHours: 0,
                    weekendHours: 0,
                    holidayHours: 0
                };

                const dayOfWeek = startDateTime.getDay();
                premiums.isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                premiums.isHoliday = this.holidays.includes(date);
                premiums.isPremiumHoliday = this.premiumHolidays.includes(date);

                let currentTime = new Date(startDateTime);
                while (currentTime < endDateTime) {
                    const hour = currentTime.getHours();
                    
                    if (hour >= 23 || hour < 7) {
                        premiums.nightHours += 1;
                    } else if (hour >= 15 && hour < 23) {
                        premiums.eveningHours += 1;
                    }

                    if (premiums.isWeekend) {
                        premiums.weekendHours += 1;
                    }

                    if (premiums.isHoliday) {
                        premiums.holidayHours += 1;
                    }

                    currentTime.setHours(currentTime.getHours() + 1);
                }

                return premiums;
            }

            getShiftsInPeriod(employeeId, startDate, endDate) {
                return this.shifts.filter(shift => 
                    shift.employeeId === employeeId &&
                    shift.date >= startDate &&
                    shift.date <= endDate
                );
            }

            calculateOvertimeForPeriod(shifts) {
                const dailyHours = {};
                const weeklyHours = {};

                shifts.forEach(shift => {
                    const date = shift.date;
                    const weekStart = this.getWeekStart(new Date(date));
                    const weekKey = weekStart.toISOString().split('T')[0];

                    if (!dailyHours[date]) dailyHours[date] = 0;
                    dailyHours[date] += shift.duration;

                    if (!weeklyHours[weekKey]) weeklyHours[weekKey] = 0;
                    weeklyHours[weekKey] += shift.duration;
                });

                let overtimeHours15 = 0;
                let overtimeHours20 = 0;

                Object.values(dailyHours).forEach(dayHours => {
                    if (dayHours > 8) {
                        const dailyOT = Math.min(dayHours - 8, 4);
                        overtimeHours15 += dailyOT;
                        
                        if (dayHours > 12) {
                            overtimeHours20 += dayHours - 12;
                        }
                    }
                });

                Object.values(weeklyHours).forEach(weekHours => {
                    if (weekHours > 40) {
                        const weeklyOT = weekHours - 40;
                        overtimeHours15 += Math.max(0, weeklyOT - overtimeHours15);
                    }
                });

                return { overtimeHours15, overtimeHours20 };
            }

            getWeekStart(date) {
                const d = new Date(date);
                const day = d.getDay();
                const diff = d.getDate() - day;
                return new Date(d.setDate(diff));
            }

            calculatePayroll(employeeId, payPeriodStart, payPeriodEnd) {
                const employee = this.getEmployee(employeeId);
                if (!employee) {
                    throw new Error(`Employee with ID ${employeeId} not found`);
                }

                const shifts = this.getShiftsInPeriod(employeeId, payPeriodStart, payPeriodEnd);
                if (shifts.length === 0) {
                    throw new Error('No shifts found for the selected pay period');
                }

                const totalHours = shifts.reduce((sum, shift) => sum + shift.duration, 0);
                const nightHours = shifts.reduce((sum, shift) => sum + shift.premiums.nightHours, 0);
                const eveningHours = shifts.reduce((sum, shift) => sum + shift.premiums.eveningHours, 0);
                const weekendHours = shifts.reduce((sum, shift) => sum + shift.premiums.weekendHours, 0);

                const holidayHours15 = shifts.reduce((sum, shift) => {
                    return sum + (shift.premiums.isHoliday && !shift.premiums.isPremiumHoliday ? shift.duration : 0);
                }, 0);
                const holidayHours20 = shifts.reduce((sum, shift) => {
                    return sum + (shift.premiums.isPremiumHoliday ? shift.duration : 0);
                }, 0);

                const overtime = this.calculateOvertimeForPeriod(shifts);
                const totalSpecialHours = overtime.overtimeHours15 + overtime.overtimeHours20 + holidayHours15 + holidayHours20;
                const regularHours = Math.max(0, totalHours - totalSpecialHours);

                const regularPay = regularHours * employee.hourlyRate;
                const overtime15Pay = overtime.overtimeHours15 * employee.hourlyRate * 1.5;
                const overtime20Pay = overtime.overtimeHours20 * employee.hourlyRate * 2.0;
                const holiday15Pay = holidayHours15 * employee.hourlyRate * 1.5;
                const holiday20Pay = holidayHours20 * employee.hourlyRate * 2.0;

                const nightPremium = nightHours * 4.00;
                const eveningPremium = eveningHours * 2.00;
                const weekendPremium = weekendHours * 2.00;

                const grossPay = regularPay + overtime15Pay + overtime20Pay + 
                               holiday15Pay + holiday20Pay + nightPremium + 
                               eveningPremium + weekendPremium;

                return {
                    employeeId: employee.id,
                    employeeName: employee.name,
                    payPeriodStart,
                    payPeriodEnd,
                    shifts,
                    hours: {
                        total: totalHours,
                        regular: regularHours,
                        overtimeHours15: overtime.overtimeHours15,
                        overtimeHours20: overtime.overtimeHours20,
                        holidayHours15,
                        holidayHours20,
                        nightHours,
                        eveningHours,
                        weekendHours
                    },
                    pay: {
                        hourlyRate: employee.hourlyRate,
                        regular: regularPay,
                        overtime15: overtime15Pay,
                        overtime20: overtime20Pay,
                        holiday15: holiday15Pay,
                        holiday20: holiday20Pay,
                        nightPremium,
                        eveningPremium,
                        weekendPremium,
                        gross: grossPay
                    },
                    calculatedAt: new Date()
                };
            }

            formatCurrency(amount) {
                return new Intl.NumberFormat('en-CA', {
                    style: 'currency',
                    currency: 'CAD'
                }).format(amount);
            }

            removeShift(shiftId) {
                this.shifts = this.shifts.filter(shift => shift.id !== shiftId);
            }
        }

        // Initialize payroll calculator
        const payroll = new SmartPayrollCalculator();
        let selectedEmployeeId = null;

        // Add sample employees
        payroll.addEmployee('Layne Trudeau', 50.00, 'RN');
        payroll.addEmployee('Domonique Ballsack', 35.00, 'LPN');
        payroll.addEmployee('Lizzie Westerly', 28.00, 'Care Aide');

        function toggleEmployeeManagement() {
            const section = document.getElementById('employeeManagement');
            const btn = document.querySelector('.toggle-btn');
            
            if (section.classList.contains('show')) {
                section.classList.remove('show');
                btn.textContent = '+ Manage Employees';
            } else {
                section.classList.add('show');
                btn.textContent = '- Hide Employee Management';
            }
        }

        function setSelectedShiftType(type) {
            payroll.selectedShiftType = type;
            
            // Update button visual feedback
            document.querySelectorAll('.btn-template').forEach(btn => {
                btn.style.transform = '';
            });
            
            event.target.style.transform = 'scale(0.95)';
            setTimeout(() => {
                event.target.style.transform = '';
            }, 150);
        }

        function generateCalendar() {
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            const startDate = new Date(payroll.currentWeekStart);
            
            // Generate 14 days (2 weeks)
            for (let i = 0; i < 14; i++) {
                const cellDate = new Date(startDate);
                cellDate.setDate(startDate.getDate() + i);
                
                const dateStr = cellDate.toISOString().split('T')[0];
                const dayOfWeek = cellDate.getDay();
                const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
                const isHoliday = payroll.holidays.includes(dateStr);
                
                const cell = document.createElement('div');
                cell.className = `calendar-cell ${isWeekend ? 'weekend' : ''} ${isHoliday ? 'holiday' : ''}`;
                cell.setAttribute('data-date', dateStr);
                cell.onclick = () => addShiftToDate(dateStr);
                
                const dayNum = cellDate.getDate();
                const monthName = cellDate.toLocaleDateString('en-US', { month: 'short' });
                
                cell.innerHTML = `
                    <div class="cell-date">${monthName} ${dayNum}</div>
                    <div class="cell-shifts" id="shifts-${dateStr}"></div>
                `;
                
                grid.appendChild(cell);
            }
            
            updateCalendarTitle();
            updateShiftsDisplay();
        }

        function updateCalendarTitle() {
            const start = new Date(payroll.currentWeekStart);
            const end = new Date(start);
            end.setDate(start.getDate() + 13);
            
            const title = `${start.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })} - ${end.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}`;
            document.getElementById('calendarTitle').textContent = title;
        }

        function changeWeek(direction) {
            const newDate = new Date(payroll.currentWeekStart);
            newDate.setDate(newDate.getDate() + (direction * 14)); // Move by 2 weeks
            payroll.currentWeekStart = newDate;
            generateCalendar();
        }

        function addShiftToDate(date) {
            if (!selectedEmployeeId) {
                showAlert('Please select an employee first.', 'error');
                return;
            }

            try {
                const shift = payroll.addShift(selectedEmployeeId, date, payroll.selectedShiftType);
                showAlert(`${payroll.selectedShiftType.charAt(0).toUpperCase() + payroll.selectedShiftType.slice(1)} shift added for ${date}`, 'success');
                updateShiftsDisplay();
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            }
        }

        function updateShiftsDisplay() {
            if (!selectedEmployeeId) return;
            
            // Clear all shift displays
            document.querySelectorAll('[id^="shifts-"]').forEach(el => {
                el.innerHTML = '';
            });
            
            // Get shifts for current employee in current 2-week period
            const startDate = payroll.currentWeekStart.toISOString().split('T')[0];
            const endDate = new Date(payroll.currentWeekStart);
            endDate.setDate(endDate.getDate() + 13);
            const endDateStr = endDate.toISOString().split('T')[0];
            
            const shifts = payroll.getShiftsInPeriod(selectedEmployeeId, startDate, endDateStr);
            
            shifts.forEach(shift => {
                const shiftEl = document.getElementById(`shifts-${shift.date}`);
                if (shiftEl) {
                    const shiftItem = document.createElement('div');
                    shiftItem.className = `shift-item ${shift.shiftType}-shift ${shift.premiums.isHoliday ? 'holiday' : ''}`;
                    shiftItem.innerHTML = `
                        <span>${shift.shiftType.charAt(0).toUpperCase()}</span>
                        <span class="shift-remove" onclick="removeShift(${shift.id}, event)">×</span>
                    `;
                    shiftEl.appendChild(shiftItem);
                }
            });
        }

        function removeShift(shiftId, event) {
            event.stopPropagation();
            payroll.removeShift(shiftId);
            updateShiftsDisplay();
            showAlert('Shift removed', 'success');
        }

        function addEmployee() {
            const name = document.getElementById('employeeName').value.trim();
            const hourlyRate = parseFloat(document.getElementById('hourlyRate').value);
            const department = document.getElementById('department').value.trim() || 'General';

            if (!name || !hourlyRate || hourlyRate <= 0) {
                showAlert('Please enter valid employee name and hourly rate.', 'error');
                return;
            }

            const employee = payroll.addEmployee(name, hourlyRate, department);
            showAlert(`Employee ${name} added successfully!`, 'success');
            
            document.getElementById('employeeName').value = '';
            document.getElementById('hourlyRate').value = '';
            document.getElementById('department').value = '';
            
            updateEmployeeList();
        }

        function updateEmployeeList() {
            const employeeList = document.getElementById('employeeList');
            
            if (payroll.employees.length === 0) {
                employeeList.innerHTML = '<div class="alert">No employees found.</div>';
                return;
            }

            employeeList.innerHTML = payroll.employees.map(emp => `
                <div class="employee-item ${selectedEmployeeId === emp.id ? 'selected' : ''}" 
                     onclick="selectEmployee(${emp.id})">
                    <strong>${emp.name}</strong> - ${payroll.formatCurrency(emp.hourlyRate)}/hr - ${emp.department}
                </div>
            `).join('');
        }

        function selectEmployee(employeeId) {
            selectedEmployeeId = employeeId;
            updateEmployeeList();
            updateShiftsDisplay();
        }

        function calculatePayroll() {
            if (!selectedEmployeeId) {
                showAlert('Please select an employee first.', 'error');
                return;
            }

            const startDate = payroll.currentWeekStart.toISOString().split('T')[0];
            const endDate = new Date(payroll.currentWeekStart);
            endDate.setDate(endDate.getDate() + 13);
            const endDateStr = endDate.toISOString().split('T')[0];

            try {
                const payrollRecord = payroll.calculatePayroll(selectedEmployeeId, startDate, endDateStr);
                displayPayStub(payrollRecord);
                updateSummaryStats(payrollRecord);
                showAlert('Payroll calculated successfully!', 'success');
            } catch (error) {
                showAlert(`Error: ${error.message}`, 'error');
            }
        }

        function updateSummaryStats(payrollRecord) {
            document.getElementById('summaryStats').style.display = 'grid';
            document.getElementById('totalHoursStat').textContent = payrollRecord.hours.total.toFixed(1);
            document.getElementById('overtimeHoursStat').textContent = (payrollRecord.hours.overtimeHours15 + payrollRecord.hours.overtimeHours20).toFixed(1);
            document.getElementById('weekendHoursStat').textContent = payrollRecord.hours.weekendHours.toFixed(1);
            document.getElementById('nightHoursStat').textContent = payrollRecord.hours.nightHours.toFixed(1);
        }

        function displayPayStub(payrollRecord) {
            const resultsDiv = document.getElementById('results');
            
            resultsDiv.innerHTML = `
                <div class="pay-stub">
                    <div class="pay-stub-header">
                        <div class="pay-stub-title">PAYROLL STUB</div>
                        <div style="margin-top: 8px; font-size: 12px;">
                            <strong>${payrollRecord.employeeName}</strong><br>
                            ${payrollRecord.payPeriodStart} to ${payrollRecord.payPeriodEnd}<br>
                            Rate: ${payroll.formatCurrency(payrollRecord.pay.hourlyRate)}/hr | Shifts: ${payrollRecord.shifts.length}
                        </div>
                    </div>

                    <div class="pay-stub-section">
                        <h4>HOURS</h4>
                        <div class="pay-row"><span>Total:</span><span>${payrollRecord.hours.total.toFixed(1)}</span></div>
                        <div class="pay-row"><span>Regular:</span><span>${payrollRecord.hours.regular.toFixed(1)}</span></div>
                        <div class="pay-row"><span>OT (1.5x):</span><span>${payrollRecord.hours.overtimeHours15.toFixed(1)}</span></div>
                        <div class="pay-row"><span>OT (2.0x):</span><span>${payrollRecord.hours.overtimeHours20.toFixed(1)}</span></div>
                        <div class="pay-row"><span>Holiday (1.5x):</span><span>${payrollRecord.hours.holidayHours15.toFixed(1)}</span></div>
                        <div class="pay-row"><span>Holiday (2.0x):</span><span>${payrollRecord.hours.holidayHours20.toFixed(1)}</span></div>
                        <div class="pay-row"><span>Night:</span><span>${payrollRecord.hours.nightHours.toFixed(1)}</span></div>
                        <div class="pay-row"><span>Evening:</span><span>${payrollRecord.hours.eveningHours.toFixed(1)}</span></div>
                        <div class="pay-row"><span>Weekend:</span><span>${payrollRecord.hours.weekendHours.toFixed(1)}</span></div>
                    </div>

                    <div class="pay-stub-section">
                        <h4>EARNINGS</h4>
                        <div class="pay-row"><span>Regular Pay:</span><span>${payroll.formatCurrency(payrollRecord.pay.regular)}</span></div>
                        <div class="pay-row"><span>OT Pay (1.5x):</span><span>${payroll.formatCurrency(payrollRecord.pay.overtime15)}</span></div>
                        <div class="pay-row"><span>OT Pay (2.0x):</span><span>${payroll.formatCurrency(payrollRecord.pay.overtime20)}</span></div>
                        <div class="pay-row"><span>Holiday (1.5x):</span><span>${payroll.formatCurrency(payrollRecord.pay.holiday15)}</span></div>
                        <div class="pay-row"><span>Holiday (2.0x):</span><span>${payroll.formatCurrency(payrollRecord.pay.holiday20)}</span></div>
                        <div class="pay-row"><span>Night Premium:</span><span>${payroll.formatCurrency(payrollRecord.pay.nightPremium)}</span></div>
                        <div class="pay-row"><span>Evening Premium:</span><span>${payroll.formatCurrency(payrollRecord.pay.eveningPremium)}</span></div>
                        <div class="pay-row"><span>Weekend Premium:</span><span>${payroll.formatCurrency(payrollRecord.pay.weekendPremium)}</span></div>
                    </div>

                    <div class="pay-row gross-pay">
                        <span><strong>GROSS PAY:</strong></span>
                        <span><strong>${payroll.formatCurrency(payrollRecord.pay.gross)}</strong></span>
                    </div>
                </div>
            `;
        }

        function showAlert(message, type = 'info') {
            const existingAlerts = document.querySelectorAll('.temp-alert');
            existingAlerts.forEach(alert => alert.remove());

            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type} temp-alert`;
            alertDiv.textContent = message;
            alertDiv.style.position = 'fixed';
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '1000';
            alertDiv.style.maxWidth = '300px';

            document.body.appendChild(alertDiv);

            setTimeout(() => {
                alertDiv.remove();
            }, 3000);
        }

        // Initialize
        updateEmployeeList();
        generateCalendar();
    </script>
</body>
</html>